.padding-top-10.padding-bottom-80
  .container
    .heading-block.text-center.margin-bottom-80
      %h3 Purchase your #{@product.name.downcase.capitalize} Package
      %hr/
      %span.margin-top-20
        If you have any questions regarding any of our packages or want to make an enquiry please fill out the form and we will get back to you as fast as we can
        %strong or you can give us a call at +447500946019
    / Form
    .col-md-6.contact-right.padding-top-30.padding-left-30
      / Success Msg
      #contact_message.success-msg
        %i.fa.fa-paper-plane-o>
        Thank You. Your Message has been Submitted
      / FORM
      #payment-form
        = form_for [@product, @transaction], class: "form-group" do |f|
          .row
            .col-md-12
              %li
              = f.text_field :date, class: "datepicker form-control", placeholder: "Select Date"
              %li
                = f.text_field :time, :ignore_date => true, placeholder: "Start Time", class: "form-control"
              %li
                = f.text_field :first_name, class: "form-control", placeholder: "First Name"
              %li
                = f.text_field :middle_name, class: "form-control", placeholder: "Middle Name (Optional)"
              %li
                = f.text_field :last_name, class: "form-control", placeholder: "Last Name"
              %li
                = f.email_field :email, class: "form-control", placeholder: "Email"
              %li
                = f.number_field :phone_number, class: "form-control", placeholder: "Phone Number"
              %li
                = f.text_area :notes, class: "form-control", placeholder: "Notes (Optional)"
              %li
                = f.text_field :postcode, class: "form-control", placeholder: "Postcode"
              %li
                = f.text_field :address, class: "form-control", placeholder: "Address (optional)"

          = f.hidden_field :payment_type, value: "PayPal"
          = f.hidden_field :product_id, value: @product.id

          -#= f.submit "Secure Checkout with PayPal", class: "btn"
          %button.paypal-button
            %span.paypal-button-title
              Buy now with
            %span.paypal-logo
              %i Pay#{content_tag(:i, "Pal")}
              %i

    .col-md-6
      .panel.panel-default
        .panel-body
          %h1 Your Order
          %hr
          .row
            .col-md-6
              #{@product.name.downcase.capitalize} Package
            .col-md-6
              £
              = @transaction.amount.to_s.gsub(/(\.)0+$/, '')
          %hr
          .row
            .col-md-6
              %b Total
            .col-md-6
              £
              = @transaction.amount.to_s.gsub(/(\.)0+$/, '')



:javascript

  function unavailable(date) {
    dmy = date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear();
    return [$.inArray(dmy, unavaibleDates) == -1];
  }

  unavaibleDates = [];

  $.ajax({
    url: '/preload',
    data: {product_id: #{@product.id}},
    dataType: "json",
    success: function(data) {
      $.each(data, function(arrID, arrValue) {
        unavaibleDates.push($.datepicker.formatDate('d-m-yy', new Date(arrValue)));
      });

      $(".datepicker").datepicker({
        dateFormat: 'yy-mm-dd',
        minDate: 0,
        maxDate: '3m',
        beforeShowDay: unavailable
      });
    }
  });

  $(document).ready(function() {
      $('#new_transaction').bootstrapValidator({
      // To use feedback icons, ensure that you use Bootstrap v3.1.0 or later
      feedbackIcons: {
        valid: 'glyphicon glyphicon-ok',
        invalid: 'glyphicon glyphicon-remove',
        validating: 'glyphicon glyphicon-refresh'
      },
      fields: {
        first_name: {
          validators: {
            stringLength: {
              min: 2,
            },
            notEmpty: {
              message: 'Please supply your first name'
            }
          }
        },
        last_name: {
          validators: {
            stringLength: {
              min: 2,
            },
            notEmpty: {
              message: 'Please supply your last name'
            }
          }
        },
        email: {
          validators: {
            notEmpty: {
              message: 'Please supply your email address'
            },
            emailAddress: {
              message: 'Please supply a valid email address'
            }
          }
        },
        phone: {
          validators: {
            notEmpty: {
              message: 'Please supply your phone number'
            },
            phone: {
              country: 'US',
              message: 'Please supply a vaild phone number with area code'
            }
          }
        },
        address: {
          validators: {
            stringLength: {
              min: 8,
            },
            notEmpty: {
              message: 'Please supply your street address'
            }
          }
        },
        city: {
          validators: {
            stringLength: {
              min: 4,
            },
            notEmpty: {
              message: 'Please supply your city'
            }
          }
        },
        state: {
          validators: {
            notEmpty: {
              message: 'Please select your state'
            }
          }
        },
        zip: {
          validators: {
            notEmpty: {
              message: 'Please supply your zip code'
            },
            zipCode: {
              country: 'US',
              message: 'Please supply a vaild zip code'
            }
          }
        },
        comment: {
          validators: {
            stringLength: {
              min: 10,
              max: 200,
              message:'Please enter at least 10 characters and no more than 200'
            },
            notEmpty: {
              message: 'Please supply a description of your project'
            }
          }
        }
      }
    })
    .on('success.form.bv', function(e) {
      $('#success_message').slideDown({ opacity: "show" }, "slow") // Do something ...
      $('#new_transaction').data('bootstrapValidator').resetForm();

      // Prevent form submission
      e.preventDefault();

      // Get the form instance
      var $form = $(e.target);

      // Get the BootstrapValidator instance
      var bv = $form.data('bootstrapValidator');

      // Use Ajax to submit form data
      $.post($form.attr('action'), $form.serialize(), function(result) {
        console.log(result);
      }, 'json');
    });
  });
